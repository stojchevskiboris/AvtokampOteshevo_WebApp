@model Project_IT.Models.Reservation

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" />
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<h2>Измени резервација</h2>
<style>
    #txtVreme {
        display: none;
    }
    #preCena {
        width: 135px;
    }
    #txtInfo {
        height:300px
    }
</style>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">

    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.Id)

    @Html.EditorFor(model => model.VremeRezervacija, new { htmlAttributes = new { @id = "txtVreme", @Value = @Model.VremeRezervacija.ToString("dd.MM.yyyy") } })


    <div class="form-group">
        @Html.LabelFor(model => model.Ime, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Ime, new { htmlAttributes = new { @class = "form-control", @id = "txtIme" } })
            @Html.ValidationMessageFor(model => model.Ime, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Prezime, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Prezime, new { htmlAttributes = new { @class = "form-control", @id = "txtPrezime" } })
            @Html.ValidationMessageFor(model => model.Prezime, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control", @id = "txtEmail" } })
            @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Telefon, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Telefon, new { htmlAttributes = new { @class = "form-control", @id = "txtTelefon" } })
            @Html.ValidationMessageFor(model => model.Telefon, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Lica, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Lica, new { htmlAttributes = new { @class = "form-control", @id = "txtLica" } })
            @Html.ValidationMessageFor(model => model.Lica, "", new { @class = "text-danger" })
        </div>
    </div>



    <div class="form-group">
        @Html.LabelFor(model => model.DataNaPristignuvanje, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.DataNaPristignuvanje, new { htmlAttributes = new { @class = "form-control", @id = "txtDateP", @Value = @Model.DataNaPristignuvanje.ToString("dd.MM.yyyy") } })
            @Html.ValidationMessageFor(model => model.DataNaPristignuvanje, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.DataNaZaminuvanje, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.DataNaZaminuvanje, new { htmlAttributes = new { @class = "form-control", @id = "txtDateZ", @Value = @Model.DataNaZaminuvanje.ToString("dd.MM.yyyy") } })
            @Html.ValidationMessageFor(model => model.DataNaZaminuvanje, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Denovi, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Denovi, new { htmlAttributes = new { @class = "form-control", @readonly = true, @id = "txtDenovi" } })
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <button class="btn btn-default" id="preCena" form="presmetajCena">Пресметај цена</button>
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Cena, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Cena, new { htmlAttributes = new { @class = "form-control", @id = "txtCena" } })
            @Html.ValidationMessageFor(model => model.Cena, "", new { @class = "text-danger" })
        </div>
    </div>


    <br /><span id="cenaError" style="color:red"></span>

    <div class="form-group">
        @Html.LabelFor(model => model.Info, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Info, new { htmlAttributes = new { @class = "form-control", @id = "txtInfo" } })
            @Html.ValidationMessageFor(model => model.Info, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Зачувај" class="btn btn-default" />
        </div>
    </div>
</div>
}

<div>
    @Html.ActionLink("Сите резервации", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}


<script>
    $(document).ready(function () {
        const $jq = $.noConflict();

        $("#txtVreme").datepicker({
            dateFormat: "dd.mm.yy"
        });

        $("#txtDateP").datepicker({
            dateFormat: "dd.mm.yy",
            changemonth: true,
            changeyear: true,
            firstDay: 1,
            dayNamesMin: ["Не", "По", "Вт", "Ср", "Че", "Пе", "Са"],
            monthNames: ["Јануари", "Февруари", "Март", "Април", "Мај", "Јуни", "Јули",
                "Август", "Септември", "Октомври", "Ноември", "Декември"]
        });
        $("#txtDateP").removeAttr("data-val-date");

        $("#txtDateZ").datepicker({
            dateFormat: "dd.mm.yy",
            changemonth: true,
            changeyear: true,
            firstDay: 1,
            dayNamesMin: ["Не", "По", "Вт", "Ср", "Че", "Пе", "Са"],
            monthNames: ["Јануари", "Февруари", "Март", "Април", "Мај", "Јуни", "Јули",
                "Август", "Септември", "Октомври", "Ноември", "Декември"],
            minDate: +1
        })
        $("#txtDateZ").removeAttr("data-val-date");

        $("#txtDateP").change(function () {
            document.getElementById("txtCena").value = "";
            if (document.getElementById("txtDateZ").value != "") {
                var time_value2 = document.getElementById("txtDateP").value
                var valuesP = time_value2.split(".");
                var dataPristignuva = new Date(valuesP[2], valuesP[1] - 1, valuesP[0]);

                var time_value3 = document.getElementById("txtDateZ").value
                var valuesZ = time_value3.split(".");
                var dataZaminuva = new Date(valuesZ[2], valuesZ[1] - 1, valuesZ[0]);
                console.log("Data Pristignat: ", dataPristignuva)
                console.log("Data Zaminuva: ", dataZaminuva)
                let difference = dataZaminuva.getTime() - dataPristignuva.getTime();
                console.log(difference);
                let totalDays = Math.ceil(difference / (1000 * 3600 * 24));
                console.log(totalDays)
                document.getElementById("txtDenovi").value = totalDays;
            }

            var time_value = document.getElementById("txtDateP").value
            var values = time_value.split(".");
            values[0]++;
            if (values[0] >= 30) {
                values[0] = "1";
                values[1]++;
                if (values[1] > 12) {
                    values[1] = 1;
                    values[2]++;
                }
                console.log(values[1])
            }
            var parsed_date = new Date(values[2], values[1] - 1, values[0]);
            console.log(values[2], values[1], values[0]);
            //            godina     mesec       den
            $("#txtDateZ").datepicker('option', 'minDate', parsed_date)



        })
        document.getElementById("txtDateP").setAttribute('autocomplete', 'off');
        document.getElementById("txtDateZ").setAttribute('autocomplete', 'off');

        $("#txtDateZ").change(function () {
            document.getElementById("txtCena").value = "";

            document.getElementById("txtDenovi").value = "";
            //Да се земат двете дати и да се пресметаат денови
            if (document.getElementById("txtDateP") != "") {
                var time_value2 = document.getElementById("txtDateP").value
                var valuesP = time_value2.split(".");
                var dataPristignuva = new Date(valuesP[2], valuesP[1] - 1, valuesP[0]);

                var time_value3 = document.getElementById("txtDateZ").value
                var valuesZ = time_value3.split(".");
                var dataZaminuva = new Date(valuesZ[2], valuesZ[1] - 1, valuesZ[0]);
                console.log("Data Pristignat: ", dataPristignuva)
                console.log("Data Zaminuva: ", dataZaminuva)
                let difference = dataZaminuva.getTime() - dataPristignuva.getTime();
                console.log(difference);
                let totalDays = Math.ceil(difference / (1000 * 3600 * 24));
                console.log(totalDays)
                document.getElementById("txtDenovi").value = totalDays;
            }
        })


        $("#preCena").click(function () {

            var ime = document.getElementById("txtIme")
            var prezime = document.getElementById("txtPrezime")
            var email = document.getElementById("txtEmail")
            var telefon = document.getElementById("txtTelefon")
            var lica = document.getElementById("txtLica")
            var dataP = document.getElementById("txtDateP")
            var dataZ = document.getElementById("txtDateZ")
            var denovi = document.getElementById("txtDenovi")

            if (email.value == "" || telefon.value == "" || ime.value == "" || prezime.value == "" || lica.value == "" || dataP.value == "" || dataZ.value == "" || denovi.value == "") {
                document.getElementById("cenaError").innerHTML = "Ве молиме внесете ги сите полиња";
                document.getElementById("txtCena").value = "";
                return;
            }
            /*
            else if (lica.value >= "4") {
                document.getElementById("cenaError").innerHTML = "";
                document.getElementById("txtCena").value = "";
                return
            }
            */
            else
                document.getElementById("cenaError").innerHTML = "";


            var vkCena = 0;
            var denoviInt = parseInt(denovi.value)
            console.log(denovi, denoviInt)
            if (denoviInt < 3)
                vkCena = denoviInt * 1480;
            if (denoviInt >= 3 && denoviInt <= 8)
                vkCena = denoviInt * 1280;
            if (denoviInt >= 9 && denoviInt <= 15)
                vkCena = denoviInt * 1180;
            if (denoviInt >= 15 && denoviInt <= 20)
                vkCena = denoviInt * 1090;
            if (denoviInt >= 21)
                vkCena = denoviInt * 980;

            var tur_tax = 0;
            var licaInt = parseInt(lica.value)
            tur_tax = licaInt * denoviInt * 40
            vkCena += tur_tax;

            document.getElementById("txtCena").value = vkCena;
        })

    })
</script>